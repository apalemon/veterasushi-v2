<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vetera Sushi - Card√°pio Online</title>
    <link rel="icon" type="image/png" href="/logo.png">
    <link rel="shortcut icon" type="image/png" href="/logo.png">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        // Fallback autom√°tico: se o Font Awesome n√£o carregar, injeta CDN alternativo
        (function() {
            try {
                const test = document.createElement('i');
                test.className = 'fas fa-question-circle';
                test.style.display = 'none';
                document.head.appendChild(test);

                const computed = window.getComputedStyle ? window.getComputedStyle(test) : null;
                const fontFamily = computed ? computed.fontFamily || '' : '';

                // Se a fonte n√£o indicar Font Awesome, injetar fallback
                if (!/Font Awesome|FontAwesome|Font Awesome 6 Free/i.test(fontFamily)) {
                    const link = document.createElement('link');
                    link.rel = 'stylesheet';
                    link.href = 'https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css';
                    link.onload = function() { console.info('[FALLBACK] Font Awesome carregado via jsDelivr'); };
                    link.onerror = function() { console.warn('[FALLBACK] N√£o foi poss√≠vel carregar Font Awesome via fallback'); };
                    document.head.appendChild(link);
                }

                test.remove();
            } catch (e) {
                // N√£o bloquear a p√°gina por causa do fallback
                console.warn('[FALLBACK] Erro no fallback Font Awesome:', e);
            }
        })();
    </script>
    <!-- Security functions -->
    <script src="/js/security.js"></script>
</head>
<script>
// Prote√ß√£o global: redireciona URLs inv√°lidas para o formato correto
document.addEventListener('DOMContentLoaded', function() {
    var path = window.location.pathname.split('/').filter(Boolean);
    // Se est√° em /gestor/cardapio ou /gestor.html/cardapio, redireciona para /cardapio
    if ((path[0] === 'gestor' || path[0] === 'gestor.html') && path[1] === 'cardapio') {
        window.location.href = '/cardapio';
        return;
    }
    // Se est√° em /index.html/cardapio, redireciona para /cardapio
    if (path[0] === 'index.html' && path[1] === 'cardapio') {
        window.location.href = '/cardapio';
        return;
    }
});
</script>
<script>
// Corrige links de navega√ß√£o para multi-loja
document.addEventListener('DOMContentLoaded', function() {
    function getStoreSlug() {
        var parts = window.location.pathname.split('/').filter(Boolean);
        // Se estiver em /NOME_DA_LOJA/gestor ou /NOME_DA_LOJA/cardapio
        if (parts.length >= 2 && !['gestor','cardapio','index.html'].includes(parts[0])) {
            return parts[0];
        }
        return '';
    }
    var loja = getStoreSlug();
    if (loja) {
        var cardapioLinks = document.querySelectorAll('a[href="/cardapio"], a[href="../cardapio"], a[href="cardapio"]');
        cardapioLinks.forEach(function(link) {
            link.setAttribute('href', '/' + loja + '/cardapio');
        });
        var gestorLinks = document.querySelectorAll('a[href="/gestor"], a[href="../gestor"], a[href="gestor"]');
        gestorLinks.forEach(function(link) {
            if (loja) {
                link.setAttribute('href', '/' + loja + '/gestor');
            } else {
                link.setAttribute('href', '/gestor.html');
            }
        });
    }
});
</script>
<body>
    <div id="site-loading-overlay" aria-hidden="false">
        <div class="loading-spinner" aria-hidden="true"></div>
        <div class="loading-text">Carregando...</div>
    </div>
    <!-- HEADER -->
    <header>
        <div class="header-container">
            <a href="/cardapio" class="logo" style="display: flex; align-items: center; gap: 10px;">
                <img src="/logo.png" alt="Vetera Sushi" style="height: 40px; width: auto;" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <span style="display: none;">Vetera Sushi</span>
            </a>
            <nav>
                <ul class="nav-menu">
                    <li><a href="/cardapio">Card√°pio</a></li>
                    <li id="gestor-menu-item" style="display: none;">
                        <a href="/gestor" class="btn-gestor" style="background: var(--vermelho-claro); color: #fff; padding: 8px 16px; border-radius: 8px; text-decoration: none; font-weight: 500;">Gestor</a>
                    </li>
                    <li id="login-menu-item">
                        <button class="btn-login" onclick="abrirModalLoginCliente()">Login</button>
                    </li>
                    <li id="cliente-logado-item" style="display: none; align-items: center; gap: 1rem;">
                        <span style="color: var(--texto-claro); font-weight: 500;">Ol√°, <span id="cliente-nome-header"></span>!</span>
                        <button class="btn-logout" onclick="fazerLogoutCliente()">Sair</button>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- MODAL DE LOGIN/REGISTRO DE CLIENTE -->
    <div class="modal-overlay" id="modal-cliente-auth">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h2 class="modal-title" id="cliente-auth-titulo"><i class="fas fa-user-circle"></i> Login</h2>
                <button class="modal-close" onclick="fecharModalCliente()"><i class="fas fa-times"></i></button>
            </div>
            <div id="cliente-auth-container" data-modo="login">
                <!-- MODO LOGIN -->
                <div id="cliente-login-form">
                    <form onsubmit="processarClienteAuth(event)">
                        <div class="form-group">
                            <label class="form-label">Telefone</label>
                            <input type="text" class="form-input" id="cliente-telefone-login" required placeholder="(00) 00000-0000">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Senha</label>
                            <input type="password" class="form-input" id="cliente-senha-login" required>
                        </div>
                        <div id="cliente-mensagem" style="margin-bottom: 1rem; text-align: center; color: var(--vermelho-claro); min-height: 20px;"></div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;">Entrar</button>
                    </form>
                    <div style="text-align: center; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--borda);">
                        <p style="color: var(--texto-medio); margin-bottom: 0.5rem;">N√£o tem conta?</p>
                        <button type="button" class="btn btn-secondary" onclick="alternarModoCliente('registro')" style="width: 100%;">Registre-se</button>
                    </div>
                </div>

                <!-- MODO REGISTRO -->
                <div id="cliente-registro-form" style="display: none;">
                    <form onsubmit="processarClienteAuth(event)">
                        <div class="form-group">
                            <label class="form-label">Nome Completo *</label>
                            <input type="text" class="form-input" id="cliente-nome-registro" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Telefone *</label>
                            <input type="text" class="form-input" id="cliente-telefone-registro" required placeholder="(00) 00000-0000">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email (opcional)</label>
                            <input type="email" class="form-input" id="cliente-email-registro" placeholder="seu@email.com">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Senha *</label>
                            <input type="password" class="form-input" id="cliente-senha-registro" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Endere√ßo *</label>
                            <input type="text" class="form-input" id="cliente-endereco-registro" required placeholder="Rua, n√∫mero">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Bairro *</label>
                            <input type="text" class="form-input" id="cliente-bairro-registro" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">CEP *</label>
                            <input type="text" class="form-input" id="cliente-cep-registro" required placeholder="00000-000">
                        </div>
                        <div id="cliente-mensagem-registro" style="margin-bottom: 1rem; text-align: center; color: var(--vermelho-claro); min-height: 20px;"></div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;">Criar Conta</button>
                    </form>
                    <div style="text-align: center; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--borda);">
                        <p style="color: var(--texto-medio); margin-bottom: 0.5rem;">J√° tem conta?</p>
                        <button type="button" class="btn btn-secondary" onclick="alternarModoCliente('login')" style="width: 100%;">Fazer Login</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- CONTAINER PRINCIPAL -->
    <div class="container">
        <!-- MENSAGEM DE LOJA FECHADA -->
        <div id="mensagem-loja-fechada" style="display: none; background: linear-gradient(135deg, rgba(220, 38, 38, 0.15) 0%, rgba(220, 38, 38, 0.25) 100%); border: 2px solid var(--vermelho-claro); border-radius: 16px; padding: 25px; margin-bottom: 2rem; text-align: center; box-shadow: 0 8px 32px rgba(220, 38, 38, 0.2); animation: slideDown 0.5s ease-out;">
            <div style="display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 15px;">
                <i class="fas fa-door-closed" style="font-size: 2.5rem; color: var(--vermelho-claro);"></i>
                <h2 style="color: var(--vermelho-claro); font-size: 1.8rem; font-weight: 700; margin: 0;">Loja Fechada</h2>
            </div>
            <p id="mensagem-loja-fechada-texto" style="color: #fff; font-size: 1.1rem; margin: 0; line-height: 1.6;">
                <!-- Mensagem ser√° atualizada aqui -->
            </p>
        </div>
        
        <div style="text-align: center; margin-bottom: 2rem;">
            <h1 style="color: var(--vermelho-claro); font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem;">
                VETERA SUSHI
            </h1>
            <p style="color: var(--texto-medio); font-size: 1rem;">Card√°pio Online</p>
            <div id="status-loja-indicador" style="margin-top: 15px; display: inline-flex; align-items: center; gap: 8px; padding: 8px 16px; background: rgba(220, 38, 38, 0.1); border-radius: 20px; border: 1px solid rgba(220, 38, 38, 0.3);">
                <!-- Status ser√° atualizado aqui -->
            </div>
        </div>

            <!-- DESTAQUE (Combos natalinos) -->
            <div id="destaque-top" style="max-width: 1100px; margin: 0 auto 2rem; display: none;">
                <!-- Conte√∫do ser√° inserido via JavaScript -->
            </div>

        <!-- FILTRO DE CATEGORIAS -->
        <div class="categorias" id="categorias-container">
            <!-- Categorias ser√£o inseridas via JavaScript -->
        </div>

        <!-- GRID DE PRODUTOS -->
        <div class="produtos-grid" id="produtos-container">
            <!-- Produtos ser√£o inseridos via JavaScript -->
        </div>
    </div>

    <!-- CARRINHO FLUTUANTE -->
    <div class="carrinho-flutuante hidden" id="carrinho-flutuante">
        <div class="carrinho-info">
            <div class="carrinho-total">Total: R$ 0,00</div>
            <div class="carrinho-itens">0 itens</div>
        </div>
        <div style="display: flex; gap: 8px; align-items: center;">
            <button class="finalizar-btn" onclick="finalizarPedido()" style="flex: 1;">Finalizar Pedido</button>
            <button onclick="limparCarrinho()" 
                    style="background: rgba(220, 38, 38, 0.2); border: 1px solid rgba(220, 38, 38, 0.3); color: var(--vermelho-claro); padding: 10px 15px; border-radius: 8px; cursor: pointer; font-size: 16px; min-width: 40px;"
                    title="Limpar carrinho">
                üóëÔ∏è
            </button>
        </div>
    </div>

    <!-- MODAL DE CARRINHO DETALHADO -->
    <div class="modal-overlay" id="modal-carrinho">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Seu Carrinho</h2>
                <button class="modal-close" onclick="fecharModal('modal-carrinho')"><i class="fas fa-times"></i></button>
            </div>
            <div id="carrinho-detalhado">
                <!-- Itens do carrinho ser√£o inseridos aqui -->
            </div>
            <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 2px solid var(--borda);">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 1rem; align-items: center;">
                    <span style="color: var(--texto-medio); display: flex; align-items: center; gap: 0.5rem;"><i class="fas fa-shopping-basket" style="color: var(--text-muted);"></i> Subtotal:</span>
                    <span style="color: var(--texto-claro); font-weight: bold;" id="carrinho-subtotal">R$ 0,00</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 1rem; align-items: center;">
                    <span style="color: var(--texto-medio); display: flex; align-items: center; gap: 0.5rem;"><i class="fas fa-tag" style="color: var(--sucesso);"></i> Desconto:</span>
                    <span style="color: var(--sucesso); font-weight: bold;" id="carrinho-desconto">R$ 0,00</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 1.5rem; align-items: center; padding-top: 1rem; border-top: 2px solid var(--borda);">
                    <span style="color: var(--texto-claro); font-size: 1.2rem; font-weight: bold; display: flex; align-items: center; gap: 0.5rem;"><i class="fas fa-calculator" style="color: var(--vermelho-claro);"></i> Total:</span>
                    <span style="color: var(--vermelho-claro); font-size: 1.5rem; font-weight: bold;" id="carrinho-total-modal">R$ 0,00</span>
                </div>
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-ticket-alt"></i> Cupom de Desconto (opcional)</label>
                    <div style="display: flex; gap: 0.5rem;">
                        <input type="text" class="form-input" id="cupom-codigo" placeholder="Digite o c√≥digo do cupom">
                        <button class="btn btn-primary" onclick="aplicarCupom()"><i class="fas fa-check"></i> Aplicar</button>
                    </div>
                    <div id="cupom-mensagem" style="margin-top: 0.5rem; font-size: 0.9rem;"></div>
                </div>
                <button class="btn btn-primary" style="width: 100%; padding: 1rem; font-size: 1.1rem;" onclick="finalizarPedido()">
                    <i class="fas fa-check-circle"></i> Finalizar Pedido
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL DE CHECKOUT -->
    <div class="modal-overlay" id="modal-checkout" style="z-index: 10000;">
        <div class="modal" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h2 class="modal-title">Finalizar Pedido</h2>
                <button class="modal-close" onclick="fecharModal('modal-checkout')"><i class="fas fa-times"></i></button>
            </div>
            
            <!-- RESUMO DO PEDIDO -->
            <div style="background: rgba(0, 0, 0, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 1.5rem;">
                <h3 style="color: #fff; margin: 0 0 15px 0; font-size: 18px; display: flex; align-items: center; gap: 0.75rem;"><i class="fas fa-receipt" style="color: var(--vermelho-claro);"></i> Resumo do Pedido</h3>
                <div id="checkout-resumo-pedido" style="max-height: 200px; overflow-y: auto;">
                    <!-- Itens ser√£o inseridos aqui -->
                </div>
                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--borda);">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px; align-items: center;">
                        <span style="display: flex; align-items: center; gap: 0.5rem;"><i class="fas fa-shopping-basket" style="color: var(--text-muted); font-size: 0.9rem;"></i> Subtotal:</span>
                        <span id="checkout-subtotal" style="font-weight: 600;">R$ 0,00</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px; color: var(--sucesso); align-items: center;">
                        <span style="display: flex; align-items: center; gap: 0.5rem;"><i class="fas fa-tag" style="font-size: 0.9rem;"></i> Desconto:</span>
                        <span id="checkout-desconto" style="font-weight: 600;">- R$ 0,00</span>
                    </div>
                    <div id="checkout-taxa-container" style="display: flex; justify-content: space-between; margin-bottom: 8px; align-items: center;">
                        <span style="display: flex; align-items: center; gap: 0.5rem;"><i class="fas fa-truck" style="color: var(--text-muted); font-size: 0.9rem;"></i> Taxa de Entrega:</span>
                        <span id="checkout-taxa" style="font-weight: 600;">R$ 0,00</span>
                    </div>
                    <div id="checkout-taxa-msg" style="font-size: 0.85rem; text-align: right; margin-bottom: 8px;"></div>
                    <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 1.3rem; margin-top: 15px; padding-top: 15px; border-top: 2px solid var(--borda); align-items: center;">
                        <span style="display: flex; align-items: center; gap: 0.75rem;"><i class="fas fa-calculator" style="color: var(--vermelho-claro);"></i> Total:</span>
                        <span style="color: var(--vermelho-claro); font-size: 1.5rem;" id="checkout-total">R$ 0,00</span>
                    </div>
                </div>
            </div>

            <!-- DADOS DO CLIENTE -->
            <div style="background: rgba(0, 0, 0, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 1.5rem;">
                <h3 style="color: #fff; margin: 0 0 15px 0; font-size: 18px;">Dados para Entrega</h3>
                
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-user"></i> Nome Completo *</label>
                    <input type="text" class="form-input" id="checkout-nome" required>
                </div>

                <div class="form-group">
                    <label class="form-label"><i class="fas fa-phone"></i> Telefone *</label>
                    <input type="tel" class="form-input" id="checkout-telefone" placeholder="(00) 00000-0000" required maxlength="15">
                    <small style="color: var(--texto-medio); font-size: 0.8rem; margin-top: 5px; display: block;">Formato: (00) 00000-0000 ou (00) 0000-0000</small>
                </div>

                <div class="form-group">
                    <label class="form-label">CPF *</label>
                    <input type="text" class="form-input" id="checkout-cpf" placeholder="000.000.000-00" required maxlength="14">
                </div>

                <div class="form-group">
                    <label class="form-label"><i class="fas fa-map-marker-alt"></i> Endere√ßo *</label>
                    <input type="text" class="form-input" id="checkout-endereco" placeholder="Rua, n√∫mero, complemento" required onblur="calcularTaxaEntregaCheckout()">
                </div>

                <div class="form-grid" style="grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label class="form-label"><i class="fas fa-building"></i> Bairro *</label>
                        <input type="text" class="form-input" id="checkout-bairro" required onblur="calcularTaxaEntregaCheckout()">
                    </div>
                    <div class="form-group">
                        <label class="form-label"><i class="fas fa-mail-bulk"></i> CEP *</label>
                        <input type="text" class="form-input" id="checkout-cep" placeholder="00000-000" required maxlength="9">
                        <small style="color: var(--texto-medio); font-size: 0.8rem; margin-top: 5px; display: block;">Formato: 00000-000</small>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label"><i class="fas fa-sticky-note"></i> Observa√ß√µes</label>
                    <textarea class="form-textarea" id="checkout-observacoes" placeholder="Observa√ß√µes sobre o pedido (opcional)" rows="2"></textarea>
                </div>
            </div>

            <!-- CUPOM DE DESCONTO -->
            <div style="background: rgba(0, 0, 0, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 1.5rem;">
                <h3 style="color: #fff; margin: 0 0 15px 0; font-size: 18px;">Cupom de Desconto</h3>
                <div style="display: flex; gap: 10px;">
                    <input type="text" class="form-input" id="checkout-cupom" placeholder="Digite o c√≥digo do cupom" style="flex: 1; text-transform: uppercase;">
                    <button type="button" class="btn btn-secondary" onclick="aplicarCupomCheckout()" style="white-space: nowrap;">Aplicar</button>
                </div>
                <div id="checkout-cupom-msg" style="margin-top: 8px; font-size: 14px;"></div>
            </div>

            <!-- FORMA DE PAGAMENTO -->
            <div id="checkout-formas-container" style="background: rgba(0, 0, 0, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 1.5rem;">
                <h3 style="color: #fff; margin: 0 0 15px 0; font-size: 18px; display: flex; align-items: center; gap: 0.75rem;"><i class="fas fa-credit-card" style="color: var(--vermelho-claro);"></i> Forma de Pagamento</h3>
                <div id="checkout-formas-list"></div>
            </div>

            <!-- BOT√ÉO FINALIZAR -->
            <button class="btn btn-primary" style="width: 100%; padding: 1rem; font-size: 1.1rem;" onclick="processarPedidoCheckout()">
                <i class="fas fa-check-circle"></i> Confirmar Pedido
            </button>
        </div>
    </div>

    <!-- MODAL PIX -->
    <div class="modal-overlay" id="modal-pix" style="z-index: 10001;">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title"><i class="fas fa-qrcode"></i> Pagamento via PIX</h2>
                <button class="modal-close" onclick="fecharModal('modal-pix')"><i class="fas fa-times"></i></button>
            </div>
            <div id="pix-container">
                <!-- QR Code ser√° inserido aqui -->
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // Tratamento global de erros para n√£o quebrar o carregamento
        window.addEventListener('error', function(e) {
            console.error('Erro capturado:', e.error);
            // N√£o quebrar o carregamento
            return true;
        });
        
        // Garantir que db existe antes de usar
        window.addEventListener('DOMContentLoaded', function() {
            // Aguardar um pouco para garantir que todos os scripts carregaram
            setTimeout(function() {
                if (typeof db === 'undefined') {
                    console.warn('db n√£o est√° definido, tentando novamente...');
                    // Tentar novamente ap√≥s mais tempo
                    setTimeout(function() {
                        if (typeof db === 'undefined') {
                            console.error('db ainda n√£o est√° definido ap√≥s espera');
                        }
                    }, 1000);
                }
            }, 500);
        });
    </script>
    <script src="/js/database.js" onerror="console.error('Erro ao carregar database.js')"></script>
    <script src="/js/auth.js" onerror="console.error('Erro ao carregar auth.js')"></script>
    <script src="/js/cliente-auth.js" onerror="console.error('Erro ao carregar cliente-auth.js')"></script>
    <script src="/js/rate-limit.js" onerror="console.error('Erro ao carregar rate-limit.js')"></script>
    <script src="/js/carrinho.js" onerror="console.error('Erro ao carregar carrinho.js')"></script>
    <script src="/js/pix.js" onerror="console.error('Erro ao carregar pix.js')"></script>
    <script src="/js/calculo-entrega.js" onerror="console.error('Erro ao carregar calculo-entrega.js')"></script>
    <script src="/js/notificacoes.js" onerror="console.error('Erro ao carregar notificacoes.js')"></script>
    <script src="/js/main.js" onerror="console.error('Erro ao carregar main.js')"></script>
    <script>
        // Fun√ß√µes de login de cliente
        function abrirModalLoginCliente() {
            const modal = document.getElementById('modal-cliente-auth');
            if (modal) {
                alternarModoCliente('login');
                modal.classList.add('active');
            }
        }
        
        function fecharModalCliente() {
            const modal = document.getElementById('modal-cliente-auth');
            if (modal) modal.classList.remove('active');
        }
        
        function alternarModoCliente(modo) {
            const titulo = document.getElementById('cliente-auth-titulo');
            const loginForm = document.getElementById('cliente-login-form');
            const registroForm = document.getElementById('cliente-registro-form');
            const container = document.getElementById('cliente-auth-container');
            
            if (modo === 'login') {
                container.dataset.modo = 'login';
                titulo.textContent = 'Login';
                loginForm.style.display = 'block';
                registroForm.style.display = 'none';
            } else {
                container.dataset.modo = 'registro';
                titulo.textContent = 'Criar Conta';
                loginForm.style.display = 'none';
                registroForm.style.display = 'block';
            }
        }
        
        function fazerLogoutCliente() {
            if (typeof window.clienteAuth !== 'undefined') {
                window.clienteAuth.logout();
            }
            atualizarMenuCliente();
            location.reload();
        }
        
        function atualizarMenuCliente() {
            const loginItem = document.getElementById('login-menu-item');
            const clienteLogado = document.getElementById('cliente-logado-item');
            const nomeHeader = document.getElementById('cliente-nome-header');
            const gestorItem = document.getElementById('gestor-menu-item');
            
            // Verificar se √© admin/staff
            const isAdmin = typeof window.auth !== 'undefined' && window.auth.isAuthenticated();
            if (gestorItem) {
                gestorItem.style.display = isAdmin ? 'block' : 'none';
            }
            
            if (typeof window.clienteAuth !== 'undefined' && window.clienteAuth.isAuthenticated()) {
                const cliente = window.clienteAuth.getCurrentCliente();
                if (cliente) {
                    if (loginItem) loginItem.style.display = 'none';
                    if (clienteLogado) clienteLogado.style.display = 'flex';
                    if (nomeHeader) nomeHeader.textContent = cliente.nome;
                }
            } else {
                if (loginItem) loginItem.style.display = 'block';
                if (clienteLogado) clienteLogado.style.display = 'none';
            }
        }
        
        function limparCarrinho() {
            if (confirm('Deseja limpar o carrinho?')) {
                if (typeof window.carrinho !== 'undefined') {
                    window.carrinho.limpar();
                }
                localStorage.removeItem('vetera_carrinho');
            }
        }
        
        // Inicializar
        document.addEventListener('DOMContentLoaded', function() {
            // Carregar sess√£o do cliente
            if (typeof window.clienteAuth !== 'undefined') {
                window.clienteAuth.loadSession();
            }
            atualizarMenuCliente();
        });
        
        // Atualizar menu periodicamente
        setInterval(atualizarMenuCliente, 2000);
        
        // Tornar fun√ß√µes globais
        window.abrirModalLoginCliente = abrirModalLoginCliente;
        window.fecharModalCliente = fecharModalCliente;
        window.alternarModoCliente = alternarModoCliente;
        window.fazerLogoutCliente = fazerLogoutCliente;
        window.atualizarMenuCliente = atualizarMenuCliente;
        window.limparCarrinho = limparCarrinho;
    </script>
</body>
</html>
